!function(t,e){angular.module("widgetkit").service("mediaPicker",["$location","$q","Application",function(t,e,i){function n(t){var e=document.createElement("a");return e.href=t,e}var a=new RegExp("^"+i.baseUrl());return{select:function(i){i=angular.extend({title:"Pick media",multiple:!1,button:{text:"Select"}},i);var r=e.defer(),o=wp.media(i).on("select",function(){var e=o.state().get("selection").map(function(e){var i=e.toJSON(),r=n(i.url);return r.host==t.host()&&(i.url=r.pathname.replace(a,"").replace(/^\//,"")),i});r.resolve(i.multiple?e:e[0])}).open();return r.promise}}}]),t(function(){t("body").on("click",".widgetkit-editor",function(i){i.preventDefault();var n,a=t(this);n=t(a.data("source")?"#"+a.data("source"):"textarea#content"),e.widgetkit.env.editor(n)}).on("click",".widgetkit-widget button",function(i){i.preventDefault();var n=t(this).nextAll("input"),a=t(this).closest("form").find(".widget-control-save");e.widgetkit.env.init("widget",JSON.parse(n.val()),function(t){n.val(JSON.stringify(t)),a.trigger("click")})}).find("[data-app]").addClass("wrap"),t(".widgetkit-editor[data-source]").each(function(){var e=t(this);t("#"+e.data("source")).addClass("uk-margin-small-top").before(e)})})}(jQuery,window);